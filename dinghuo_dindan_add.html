<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<meta name="keywords" content=" ">
		<meta name="description" content=" ">
		<title></title>
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
		<link rel="stylesheet" type="text/css" href="css/index.css" />
		<link rel="stylesheet" type="text/css" href="font-awesome-4.7.0/css/font-awesome.min.css" />
		<link rel="stylesheet" type="text/css" href="css/zui.min.css" />
		<link rel="stylesheet" type="text/css" href="css/chosen.min.css" />
		<link rel="stylesheet" href="css/jquery.ui.css" type="text/css" />
		<link rel="stylesheet" type="text/css" href="css/css.css" />
		<link rel="stylesheet" type="text/css" href="css/scarlett.css" />
	</head>

	<body>
		<h3 class="col-md-12 title"><a class="dthis" href="">订货单</a><span class="bread">&gt;</span><a href="">新增订单</a></h3>
		<div class="col-md-12 con con1">
			<form id="form" action="" method="post">
				<div class="modal-hed">
					<div class="row col-xs-12 clearfix">
						<div class="col-xs-1">
							<h4 >商家</h4>
						</div>
						<div class="col-xs-4">
							<span class="con-warp-tit col-xs-3"><i class="red">*</i>商家名称：</span>
								<div class="staff-choose">
										<span class="fa fa-user"></span>
										<select data-placeholder="选择商家" class="chosen-select form-control" tabindex="-1" style="display: none;">
											<option value=""></option>
											<option value="cat">小猫</option>
											<option value="fish">金鱼</option>
											<option value="dragon">龙</option>
											<option value="mammoth">猛犸</option>
											<option value="gollum">咕噜</option>
										</select>
								</div>
						</div>
						<div class="col-xs-4">
							<span class="con-warp-tit col-xs-3"><i class="red">*</i>结算方式：</span>
								<div class="">
										<span id="paytype"></span>
										<input type="hidden" name="clearing_form" value="" />
								</div>
						</div>
					</div>
				</div>
				<div class="modal-hed1">
					<div class="modal-hed-content">
						<table class="table">
							<thead>
								<tr>
									<th></th>
									<th>操作</th>
									<th width="20%">商品</th>
									<th>品牌</th>
									<th>分类</th>
									<th>规格</th>
									<th>交货期</th>
									<th>单价</th>
									<th>数量</th>
									<th>小计</th>
									<th>备注</th>
								</tr>
							</thead>
							<tbody>
								<tr>
									<td>1</td>
									<td>
										<a class="delet_row fa fa-minus"></a>
									</td>
									<td>
										<div class="combobox">
											<input name="name" class="input" placeholder="点击此处选择商品">
											<ul>
												<li>
													<img src="img/goods.png" alt="" />
													<p class="list-link1">10094<span class="state">多规格</span></p>
													<p class="list-link2">百年纪念高跟鞋2016夏季新款单鞋细跟女鞋尖头鞋子呵呵1</p>
												</li>
												<li>
													<img src="img/goods.png" alt="" />
													<p class="list-link1">10095</p>
													<p class="list-link2">百年纪念高跟鞋2016夏季新款单鞋细跟单鞋工作鞋呵呵2</p>
												</li>
												<li>
													<img src="img/goods.png" alt="" />
													<p class="list-link1">10096<span class="state">多规格</span></p>
													<p class="list-link2">百年纪念高跟鞋2016夏季新款单鞋鞋呵呵3</p>
												</li>
											</ul>
										</div>
									</td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
									<td></td>
								</tr>
							</tbody>
							<!--<tfoot>
								<tr>
									<td colspan="2">合计</td>
									<td>0种</td>
									<td colspan="4"></td>
									<td>0</td>
									<td></td>
									<td>￥<span>0.00</span></td>
									<td></td>
								</tr>
							</tfoot>-->
						</table>
						<div class="desCont">
							<div class="desContL">
								<div class="desContLC">
									<div class="desContLCSet">
										<label>优惠方式：</label>
										<select name="">
											<option value="" selected></option>
											<option value=""></option>
										</select>
									</div>
								</div>
							</div>
							<div class="desContR">
								<div class="desContRC">
									<span>商品合计：</span>
									<span class="desContRCC">
										<em class="goods_kind_num">0</em>
									</span>
								</div>
								<div class="desContRC">
									<span>优惠金额：</span>
									<span class="desContRCC">
										<em class="goods_total_num">0</em>
									</span>
								</div>
								<div class="desContRC">
									<span>运&nbsp;&nbsp;&nbsp;费：<i class="glyphicon glyphicon-edit"></i></span>
									<span class="desContRCC">
										<b>￥</b><input value="0"/>
									</span>
								</div>
								<div class="desContRC">
									<span>订单总额：</span>
									<span class="desContRCC">
										<b class="redColor">￥</b><em class="redColor goods_total_price">0.00</em>
									</span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-hed2">
					<h4>备注</h4>
					<div class="btfContD">
						<span>订单备注：</span>
						<input />
					</div>
					<div class="btfContU">
						<span>内部沟通：</span>
						<input />
					</div>
				</div>
				<div class="modal-hed2">
					<h4>发票</h4>
					<div class="btfContD">
						<span>发票类型：</span>
						<label>
							<input type="radio" id="radio-1-1" name="radio-2-set" class="regular-radio" checked /><label for="radio-2-1"></label>
							不需要发票
						</label> 

						<label  class="invo">
							<input type="radio" id="radio-1-2" name="radio-2-set" class="regular-radio" /><label for="radio-2-2"></label>
								普通发票
						</label>
						<!--<input />-->
					</div>
				</div>
				<div class="modal-hed2">
					<h4>交货</h4>
					<div class="btfContD">
						<span>配送方式：</span>
						<select name="">
							<option>测试测试1</option>
							<option>测试测试2</option>							
						</select>
					</div>
					<div class="btfContU">
						<span><i class="red">*</i>收货地址：</span><a class="fa fa-pencil-square-o new-od-ed" href=""></a>
						<input value="客户名称：某某公司，  收货人：XX ， 联系电话：13500135000 ， 地址：深圳南山区"/>
					</div>
				</div>
				<div class="modal-hed2">
					<h4>附件</h4>
					<div class="btfContD">
						<div class="btfContDBtn">
							<span class="btn">+附件</span><i class="fa fa-question" title="附件最大为 6MB，支持格式：PDF、DOC、DOCX、XLS、XLSX、TXT、JPG、JPEG、PNG、RAR、ZIP "></i>
						</div>
					</div>
				</div>
				<div class="subtn">
					<input type="submit" value="确认" /> <input type="button" id="" value="取消" />
				</div>
			</form>
		</div>

		<!--选择多规格之后的弹出块-->	
		<div class="pop_into" style="display: none;">
			<div class="poper_into"></div>
			<div class="pop-warp_into">
				<!--此处假定返回的多规格的数据-->
				
				<!--此处假定返回的多规格的数据-->	
				<form action="" method="post">
					<h5 class="pp-tit_into"></h5>
					<div class="rel-con_into">
						<table id="base-as" class="table table-cus table-bordered">
							<thead>
								<tr>
									<th colspan="8">颜色</th>
								</tr> 
							</thead>
							<tbody>
								
							</tbody>
							<tfoot>
								<tr>
									<td colspan="1">全部规格数量：</td>
									<td colspan="2"><input class="affirm1_num" id="affirm1_num" type="text"><span id="affirm1" class="affirm1">确定</span><span id="clear1" class="clear1">清空</span></td>
									<td colspan="3"><span id="affirm2" class="affirm2" type="button">确定</span><span id="close1" class="close1">关闭</span></td>
								</tr>
							</tfoot>
						</table>
					</div>
				</form>
			</div>
		</div>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="js/zui.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript" src="js/chosen.min.js" charset="utf-8"></script>
		<script type="text/javascript" src="js/jquery.ui.js"></script>
		<script type="text/javascript" src="js/moment.min.js"></script>
		<script type="text/javascript" src="js/stay1.js"></script>
		<script type="text/javascript">
			$(document).ready(function() {
				/*插入行标识*/
				var inventory_num_tag = 1;
				
				/*计算价格和商品总数*/
				function priceTalNum(tag){
					/*商品合计价格和数量*/
					var goods_pri_inp_ary=[];
					var goods_price_tal=$(".modal-hed-content table tbody tr td:nth-child(9) input");
					var goods_price_ary=[];
					var goods_numbers=$(".modal-hed-content table tbody tr td:nth-child(8) .lskdo");
					var goods_numbers_ary=[];
					var goods_pri_inp_tal=0;
					var goods_number_total1=0;
					for(var s=0;s<goods_numbers.length;s++){
						var goods_numbers_this=parseInt($(goods_numbers[s]).val());
						if(goods_numbers_this){
							goods_numbers_ary.push(goods_numbers_this);
						}
						goods_number_total1+=goods_numbers_this;
					}
					for(var s1=0;s1<goods_price_tal.length;s1++){
						var goods_price_this=parseFloat($(goods_price_tal[s1]).val());
						if(goods_price_this){
							goods_price_ary.push(goods_price_this);
						}
					}
					for(var s3=0;s3<goods_price_tal.length;s3++){
						goods_pri_inp_tal+=(parseInt(goods_numbers_ary[s3])*parseFloat(goods_price_ary[s3]));
					}
					/*商品数量*/
					$($(".modal-hed-content table tfoot tr td")[3]).html(goods_number_total1);
					//$(".goods_total_num").html(goods_number_total1);
					/*订单总和*/
					$($(".modal-hed-content table tfoot tr td")[5]).html(goods_pri_inp_tal.toFixed(2));
					$(".goods_total_price").html(goods_pri_inp_tal.toFixed(2));
					/*修改商品表格最后一行排序*/
					$($(".modal-hed-content table tbody tr:last-child td")[0]).html(inventory_num_tag);
					
					/*商品种数*/
					var pop_into_fot_td = $(".modal-hed-content table tfoot tr td");
					$(pop_into_fot_td[1]).html((inventory_num_tag-1)+"种");
					$(".goods_kind_num").html(inventory_num_tag-1);
					/*重写排序数值*/
					var modal_hed_tr=$(".modal-hed-content table tbody tr td:first-child");
					for(var i=0;i<modal_hed_tr.length;i++){
						$(modal_hed_tr[i]).html(i+1);							
					}
				}
				
				/*搜索方法*/
				$('select.chosen-select').chosen({
					no_results_text: '没有找到', // 当检索时没有找到匹配项时显示的提示文本
					disable_search_threshold: 3, // 10 个以下的选择项则不显示检索框
					search_contains: true, // 从任意位置开始检索
					allow_single_deselect: true,
					width: "94px"
				});
				
				/*改变单个商品进货价*/
				changePrice();
				function changePrice(){
					$(".goods_pri_input").keyup(function(){
						priceTalNum();
					});
				}
				/*编写商品数量*/
				editNumber();
				function editNumber(){
					$(".lskdo").on("mouseout",function(){
						var lsoek_pre=$(this).parent().parent().prev();
						var lsoek_entity=$(lsoek_pre).prev();
						var lsoek = $(this);
						var lskoe = parseInt(lsoek.val());
						if(lskoe){
							if(lskoe<parseInt($(lsoek_entity).text())){
								lsoek.val(lskoe);
								$(lsoek_pre).html(lskoe);
							}else{
								lskoe = parseInt($(lsoek_entity).text());
								lsoek.val(lskoe);
								$(lsoek_pre).html(lskoe);
							}
							lskoe = parseInt(lsoek.val());
							$(lsoek_pre).html(lskoe);
						}else{
							lsoek.val(1);
							lskoe=1;
							$(lsoek_pre).html(lskoe);
						}
						priceTalNum();
					}).on("keyup",function(){
						var lsoek_pre=$(this).parent().parent().prev();
						var lsoek_entity=$(lsoek_pre).prev();
						var lsoek = $(this);
						var lskoe = parseInt(lsoek.val());
						if(lskoe){
							if(lskoe<parseInt($(lsoek_entity).text())){
								lsoek.val(lskoe);
								$(lsoek_pre).html(lskoe);
							}else{
								lskoe = parseInt($(lsoek_entity).text());
								lsoek.val(lskoe);
								$(lsoek_pre).html(lskoe);
							}
						}else if(lskoe==0){
							lsoek.val(1);
							lskoe = 1;
							$(lsoek_pre).html(lskoe);
						}
						priceTalNum();
					});
				}
				
				/*删除当前行操作*/
				delet_row();
				function delet_row(){
					$(".delet_row").prop('onclick', null).off('click').click(function(){
						var delet_this=$(this).parent().parent();
						var delet_tdStr=$($(delet_this).find('td')[4]).text();
						if(delet_tdStr){
							delet_this.remove();
							inventory_num_tag--;
							var modal_hed_tr=$(".modal-hed-content table tbody tr td:first-child");
							for(var i=0;i<modal_hed_tr.length;i++){
								$(modal_hed_tr[i]).html(i+1);							
							}
						}
						/*行删除，个数改变，价格改变*/
						priceTalNum();
						
					});
				}
				
				
				/*商品数量的加减*/				
				plusMinus();
				function plusMinus() {
					$(".jian").prop('onclick', null).off('click').click(function() {
						var lsoek = $(this).parent().find(".lskdo");
						var lsoek_pre=$(this).parent().parent().prev();
						var lskoe = parseInt(lsoek.val());
						if(lskoe){
							lskoe = parseInt(lsoek.val());
						}
						else{
							lsoek.val(0);
							lskoe=0;
						}
						if($(".pop_into").css("display")=="none"){
							if(lsoek.val() > 1){
								lsoek.val(lskoe - 1);
								lsoek_pre.html(lskoe-1);
								/*操作加减导致个数改变，价格改变*/
								priceTalNum();
							}
						}else{
							if(lsoek.val() > 0){
								var lskoe = parseInt(lsoek.val());
								lsoek.val(lskoe - 1);
							}
						}
					})
					
					$(".jia").prop('onclick', null).off('click').click(function(e, iiii) {
						var lsoek = $(this).parent().find(".lskdo");
						var lsoek_pre=$(this).parent().parent().prev();
						var lskoe = parseInt(lsoek.val());
						if(lskoe){
							lskoe = parseInt(lsoek.val());
						}
						else{
							lsoek.val(0);
							lskoe=0;
						}
						lsoek.val(lskoe + 1);
						if($(".pop_into").css("display")=="none"){
							lsoek_pre.html(lskoe+1);
							//操作加减导致个数改变，价格改变
							priceTalNum();
							
						}
					})
					
				}
				/*表格中商品选择搜索框操作*/
				ser_show_hide();
				function ser_show_hide() {
					$(".combobox .input").on('focus', function() {
						$(this).attr('placeholder', '名称/编号/关键字/(匹配)');
					}).on('blur', function() {
						$(this).attr('placeholder', '');
					}).on('keyup', function() {
						var $ul = $(this).next();
						$ul.find(".no-result").remove();
						console.log(this.value)
						var $results = $ul.find("li").hide().filter(":contains('" + this.value + "')").show();
						if(!$results.length) {
							$ul.append("<li class='no-result'>无法查找</li>");
						}
					});
					$('.modal-hed-content').on('mousedown','.combobox ul li', function (){
						var state=$(this).find("span.state")
						if(state && $(state).text()){
							$(".pop_into").css("display", "block");
							/*假设返回的被选择的多规格数据如下*/
							var choiceData={"name":"商品名称测试测试","rule":[{"uuid":"43535","rule":{"1":{"key":"颜色","value":"浅绿色"},"2":{"key":"尺寸","value":"1"},"3":{"key":"效果","value":"效果描述"},"4":{"key":"加工","value":"1"}}},{"uuid":"999535","rule":{"1":{"key":"颜色","value":"紫色"},"2":{"key":"尺寸","value":"2"},"3":{"key":"效果","value":"效果描述"},"4":{"key":"加工","value":"2"}}},{"uuid":"32335","rule":{"1":{"key":"颜色","value":"黑色"},"2":{"key":"尺寸","value":"3"},"3":{"key":"效果","value":"效果描述"},"4":{"key":"加工","value":"3"}}}]};
							/*根据数据绘制弹窗内容*/ 
							$('#base-as tbody').empty();
                            $(".pp-tit_into").html('');
                            $(".pp-tit_into").html(choiceData.name);
                            var choicehtml='';
                            $.each(choiceData.rule,function(k,v){
                        		choicehtml+="<tr>";
                        		choicehtml+="<td>";
                            	choicehtml+="<input name='uuid[]' type='hidden' value="+v.uuid+">";
                            	$.each(v.rule,function(key,rule){
                                    choicehtml+= rule.key +":"+ rule.value+"&nbsp;&nbsp;" ;
                                });
                            	choicehtml+="</td>";
                            	choicehtml+='<td colspan="4"><div class="cfs pull-left"><a class="jian">-</a><input class="lskdo" value="0" type="text"><a class="jia">+</a></div></td>';
                            	choicehtml+="</tr>";
                            	
                            });
                            $('#base-as').append(choicehtml);
							
							/*将显示块中的input值为0*/
							var input_lskdo_num= $(".pop_into input.lskdo");
							for(var i=0;i<input_lskdo_num.length;i++){
								$(input_lskdo_num[i]).val(0);
							}
							/*整体改变input值设为1*/
							$(".affirm1_num").val(1);
							plusMinus();
							
						}else{
							/*选中的没有多规格的商品的信息*/
							/*假设非规格商品的数据*/
							
							var dataSingle={"code":"5444324","name":"没考虑到商品名称商品名称商品名称","pic":"img/goods.png","unit":"件","stock":"214","price":"12","id":"5412334"};
							var combobox_elemTr=$(".modal-hed-content table tbody tr:last-child");
							inventory_num_tag++;
							var combobox_elem_html = '<div class="combobox_elem"><img src="' + dataSingle.pic + '" alt="" /><p class="list-link1">' + dataSingle.code + '</p><a class="list-link2" title="'+dataSingle.name+'">' + dataSingle.name + '</a></div>';
							var specification="";
							combobox_elemTr.before("<tr><td>"+inventory_num_tag+"</td><td><a class='delet_row fa fa-minus'></a></td><td>"+combobox_elem_html+"</td><td>"+specification+"</td><td>"+dataSingle.unit+"</td><td>"+dataSingle.stock+"</td><td>1</td><td><div class='cfs pull-left'><a class='jian'>-</a><input class='lskdo' type='text' value='1'><a class='jia'>+</a></div></td><td><input class='goods_pri_input' name='price' value='"+dataSingle.price+"'/></td><td>"+dataSingle.price+"</td><td><textarea name='remark[]'></textarea></td></tr>");
                            plusMinus();
							priceTalNum();
							delet_row();
							changePrice();
							editNumber();
						}
					})
				}

				$(".affirm1").click(function() {
					var affirm1_num = $(".affirm1_num").val();
					if(affirm1_num) {
						if(parseInt(affirm1_num) > 0) {
							var pop_into_num = $(".pop_into .lskdo");
							for(var i = 0; i < pop_into_num.length; i++) {
								$(pop_into_num[i]).val(parseInt(affirm1_num));
							}
						} else {
							alert("订购数量必须为1的倍数");
						}
					} else {
						alert("订购数量必须为1的倍数");
					}
				});
				$(".clear1").click(function() {
					var pop_into_num = $(".pop_into .lskdo");
					for(var i = 0; i < pop_into_num.length; i++) {
						$(pop_into_num[i]).val(0);
					}
				});
				$(".close1").click(function() {
					$(".pop_into").css("display", "none")
				});
				$(".affirm2").click(function() {
					/*可选规格对应的input*/	
					var pop_into_num = $(".pop_into .lskdo");
					/*可选规格对应的td数*/
	                var pop_into_num1 = $(".pop_into table tbody td:nth-child(n)");
	                /*商品名称--对应表格顶部位置*/
	                var pop_into_titil = $(".pp-tit_into").text();
	                /*商品数大于1的数组*/
	                var pop_into_val = [];
	                /*存储商品插入后，在表格中的排序*/
	                var pop_into_rank = [];
	                /*操作*/
	                var pop_into_operate = '<a class="delet_row fa fa-minus"></a>';
	                /*商品的信息*/
	                var pop_into_str = [];
	                /*商品规格属性*/
	                var pop_into_string = [];
	                /*商品备注*/
	                var pop_into_remark = "<textarea name='remark[]'></textarea>";
	                /*商品图片*/
	                var img=[];
	                /*商品编码*/
	                var code=[];
	                /*商品名称*/
	                var name=[];
	                /*商品单位*/
	                var unit=[];
	                /*商品实际库存*/
	                var stock=[];
	                /*商品价格*/
	                var price=[];
	                for (var i = 0; i < pop_into_num.length; i++) {
	                    /*请求每个商品个数大于0的数据*/
	                    var dataSingle={"code":"324324","name":"商品名称商品名称商品名称商品名称","pic":"img/goods.png","unit":"件","stock":"234","price":"32.34","id":"12334"}
	                    img.push(dataSingle.pic);
	                    code.push(dataSingle.code);
	                    name.push(dataSingle.name);
	                    unit.push(dataSingle.unit);
	                    stock.push(dataSingle.stock);
	                    price.push(dataSingle.price);
	                    var pop_into_num_val = $(pop_into_num[i]).val();
	                    if (pop_into_num_val && parseInt(pop_into_num_val) > 0) {
	                        pop_into_val.push(pop_into_num_val);
	                        pop_into_rank.push(inventory_num_tag);
	                        inventory_num_tag++;
	                        pop_into_string.push($(pop_into_num[i]).parent().parent().prev().text());
	                    }
	                    var combobox_elem_html = '<div class="combobox_elem"><img src="' + img[i] + '" alt="" /><p class="list-link1">' + code[i] + '</p><a class="list-link2" title="'+ name[i]+'">' + name[i] + '</a></div>';
	                    pop_into_str.push(combobox_elem_html);
	                }
	                /*关闭弹窗*/
	                $(".pop_into").css("display", "none");
	                /*执行插入块*/
	                for(var j=0;j<pop_into_val.length;j++){
	                	var pop_into_last = $(".modal-hed-content table tbody tr:last-child");
	                	pop_into_last.before("<tr><td>"+pop_into_rank[j]+"</td><td>"+pop_into_operate+"</td><td>"+pop_into_str[j]+"</td><td>"+pop_into_string[j]+"</td><td>"+unit[j]+"</td><td>"+stock[j]+"</td><td>"+pop_into_val[j]+"</td><td><div class='cfs pull-left'><a class='jian'>-</a><input class='lskdo' type='text' value='"+pop_into_val[j]+"'><a class='jia'>+</a></div></td><td><input class='goods_pri_input' name='price' value='"+price[j]+"'/></td><td>"+price[j]+"</td><td>"+pop_into_remark+"</td></tr>");
	                }
					plusMinus();
					priceTalNum();
					delet_row();
					changePrice();
					editNumber();
				});
			})
		</script>
	</body>

</html>